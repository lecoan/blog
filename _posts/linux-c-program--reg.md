---
title: 一站式C编程-正则表达式
tags:
- Linux
- C
categories: Linux
---



# 一站式C编程 -正则表达式

**表 32.1. 字符类**

<!--more-->

| 字符          | 含义                              | 举例                                       |
| ----------- | ------------------------------- | ---------------------------------------- |
| `.`         | 匹配任意一个字符                        | `abc.`可以匹配`abcd`、`abc9`等                 |
| `[]`        | 匹配括号中的任意一个字符                    | `[abc]d`可以匹配`ad`、`bd`或`cd`               |
| `-`         | 在`[]`括号内表示字符范围                  | `[0-9a-fA-F]```可以匹配一位十六进制数字              |
| `^`         | 位于`[]`括号内的开头，匹配除括号中的字符之外的任意一个字符 | `[^xy]`匹配除`xy`之外的任一字符，因此`[^xy]1`可以匹配`a1`、`b1`但不匹配`x1`、`y1` |
| `[[:xxx:]]` | `grep`工具预定义的一些命名字符类             | `[[:alpha:]]`匹配一个字母，`[[:digit:]]`匹配一个数字  |

**表 32.2. 数量限定符**

| 字符      | 含义                        | 举例                                       |
| ------- | ------------------------- | ---------------------------------------- |
| `?`     | 紧跟在它前面的单元应匹配零次或一次         | `[0-9]?\.[0-9]`匹配`0.0`、`2.3`、`.5`等，由于`.`在正则表达式中是一个特殊字符，所以需要用`\`转义一下，取字面值 |
| `+`     | 紧跟在它前面的单元应匹配一次或多次         | `[a-zA-Z0-9_.-]+@[a-zA-Z0-9_.-]+\.[a-zA-Z0-9_.-]+`匹配email地址 |
| `*`     | 紧跟在它前面的单元应匹配零次或多次         | `[0-9][0-9]*`匹配至少一位数字，等价于`[0-9]+`，`[a-zA-Z_]+[a-zA-Z_0-9]*`匹配C语言的标识符 |
| `{N}`   | 紧跟在它前面的单元应精确匹配`N次`        | `[1-9][0-9]{2}`匹配从`100`到`999`的整数         |
| `{N,}`  | 紧跟在它前面的单元应匹配至少`N`次        | `[1-9][0-9]{2,}`匹配三位以上（含三位）的整数           |
| `{,M}`  | 紧跟在它前面的单元应匹配最多`M`次        | `[0-9]{,1}`相当于`[0-9]?`                   |
| `{N,M}` | 紧跟在它前面的单元应匹配至少`N`次，最多`M`次 | `[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}`匹配IP地址 |

**表 32.3. 位置限定符**

| 字符   | 含义            | 举例                                       |
| ---- | ------------- | ---------------------------------------- |
| `^`  | 匹配行首的位置       | `^Content`匹配位于一行开头的`Content`             |
| `$`  | 匹配行末的位置       | `;$`匹配位于一行结尾的`;`号，`^$`匹配空行               |
| `\<` | 匹配单词开头的位置     | `\<th`匹配`... this`，但不匹配`ethernet`、`tenth` |
| `\>` | 匹配单词结尾的位置     | `p\>`匹配`leap ...`，但不匹配`parent`、`sleepy`  |
| `\b` | 匹配单词开头或结尾的位置  | `\bat\b`匹配`... at ...`，但不匹配`cat`、`atexit`、`batch` |
| `\B` | 匹配非单词开头和结尾的位置 | `\Bat\B`匹配`battery`，但不匹配`... attend`、`hat ...` |

**表 32.4. 其它特殊字符**

| 字符   | 含义                                 | 举例                                       |
| ---- | ---------------------------------- | ---------------------------------------- |
| `\`  | 转义字符，普通字符转义为特殊字符，特殊字符转义为普通字符       | 普通字符`<`写成`\<`表示单词开头的位置，特殊字符`.`写成`\.`以及`\`写成`\\`就当作普通字符来匹配 |
| `()` | 将正则表达式的一部分括起来组成一个单元，可以对整个单元使用数量限定符 | `([0-9]{1,3}\.){3}[0-9]{1,3}`匹配IP地址      |
| `|`  | 连接两个子表达式，表示或的关系                    | `n(o|either)`匹配`no`或`neither`            |

## 3. sed

`sed`意为流编辑器（Stream Editor），在Shell脚本和Makefile中作为过滤器使用非常普遍，也就是把前一个程序的输出引入sed的输入，经过一系列编辑命令转换为另一种格式输出。`sed`和`vi`都源于早期UNIX的`ed`工具，所以很多`sed`命令和`vi`的末行命令是相同的。

表 32.5. 常用的sed命令**

| `/pattern/p`                     | 打印匹配`pattern`的行                          |
| -------------------------------- | ---------------------------------------- |
| `/pattern/d`                     | 删除匹配`pattern`的行                          |
| `/pattern/s/pattern1/pattern2/`  | 查找符合`pattern`的行，将该行第一个匹配`pattern1`的字符串替换为`pattern2` |
| `/pattern/s/pattern1/pattern2/g` | 查找符合`pattern`的行，将该行所有匹配`pattern1`的字符串替换为`pattern2` |

使用查找替换命令时，可以把匹配`pattern1`的字符串复制到`pattern2`中，比如：

```shell
sed 's/bc/-&-/' testfile #s前不加表达式对所有符合条件字符串替换
123
a-bc-
456
```

`pattern2`中的`&`表示原文件的当前行中与`pattern1`相匹配的字符串，再比如：

```shell
sed 's/\([0-9]\)\([0-9]\)/-\1-~\2~/' testfile
-1-~2~3
abc
-4-~5~6
```

`pattern2`中的`\1`表示与`pattern1`的第一个`()`括号相匹配的内容，`\2`表示与`pattern1`的第二个`()`括号相匹配的内容。`sed`默认使用Basic正则表达式规范，如果指定了`-r`选项则使用Extended规范，那么`()`括号就不必转义了。

正则表达式中的数量限定符会匹配尽可能长的字符串

如果`testfile`的内容是

```html
<html><head><title>Hello World</title>
<body>Welcome to the world of regexp!</body></html>
```

现在要去掉所有的HTML标签，使输出结果为

```
Hello World
Welcome to the world of regexp!
```

```shell
sed 's/<[^>]*//g' testfile # 把*换成+就不行了？
```

